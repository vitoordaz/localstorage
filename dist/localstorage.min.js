define("localstorage",["underscore"],function(a){"use strict";var b=function(){},c=!1,d={},e=window.chrome&&chrome.storage&&chrome.storage.local;return e?{init:function(a){chrome.storage.local.get(null,function(b){d=b,c=!0,a()})},clear:function(a){if(!c&&!a)throw Error("localstorage.init was not called");a=a||b,chrome.storage.local.clear(a),d={}},setItem:function(a,e,f){if(!c&&!f)throw Error("localstorage.init was not called");f=f||b;var g={};g[a]=e,chrome.storage.local.set(g,f),d[a]=e},getItem:function(a,e){if(!c&&!e)throw Error("localstorage.init was not called");return e=e||b,chrome.storage.local.get(a,function(b){d[a]=b[a],e(b[a])}),d[a]},removeItem:function(a,e){if(!c&&!e)throw Error("localstorage.init was not called");e=e||b,chrome.storage.local.remove([a],e),delete d[a]}}:{init:a.defer,clear:function(c){a.defer(function(){localStorage.clear(),(c||b)()})},setItem:function(c,d,e){a.defer(function(){localStorage.setItem(c,d),(e||b)()})},getItem:function(c,d){a.defer(function(){(d||b)(localStorage.getItem(c))})},removeItem:function(c,d){a.defer(function(){localStorage.removeItem(c),(d||b)()})}}});